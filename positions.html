<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Position Management - Financial Management System</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
      }

      :root {
        --primary: #2563eb;
        --primary-light: #3b82f6;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --dark: #1e293b;
        --darker: #0f172a;
        --light: #f8fafc;
        --gray: #94a3b8;
        --border: #e2e8f0;
        --card-bg: #ffffff;
        --header-bg: #ffffff;
        --body-bg: #f1f5f9;
        --chart-gradient: linear-gradient(
          90deg,
          rgba(37, 99, 235, 0.1),
          rgba(59, 130, 246, 0.05)
        );
      }

      body {
        background-color: var(--body-bg);
        color: var(--dark);
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
        background-color: var(--header-bg);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo i {
        color: var(--primary);
        font-size: 28px;
      }

      .logo h1 {
        font-size: 24px;
        font-weight: 700;
        color: var(--darker);
      }

      .nav-tabs {
        display: flex;
        gap: 15px;
        list-style: none;
      }

      .nav-tabs li a {
        color: var(--gray);
        text-decoration: none;
        font-weight: 500;
        padding: 8px 16px;
        border-radius: 20px;
        transition: all 0.3s ease;
        font-size: 15px;
      }

      .nav-tabs li a.active,
      .nav-tabs li a:hover {
        background-color: rgba(37, 99, 235, 0.08);
        color: var(--primary);
      }

      .panel {
        background-color: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        padding: 25px;
        margin-bottom: 25px;
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
      }

      .panel-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--darker);
      }

      .panel-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 8px 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        font-size: 14px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .btn-primary {
        background-color: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-light);
      }

      .btn-outline {
        background-color: transparent;
        border: 1px solid var(--border);
        color: var(--dark);
      }

      .btn-outline:hover {
        background-color: var(--light);
      }

      .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .summary-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border);
        transition: all 0.3s ease;
      }

      .summary-card:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.07);
        transform: translateY(-3px);
      }

      .summary-card-title {
        font-size: 15px;
        color: var(--gray);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .summary-card-value {
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 6px;
      }

      .summary-card-info {
        font-size: 14px;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .positive {
        color: var(--success);
      }

      .negative {
        color: var(--danger);
      }

      .chart-container {
        height: 300px;
        margin: 25px 0;
        background-color: var(--light);
        border-radius: 12px;
        padding: 15px;
        background-image: var(--chart-gradient);
      }

      .data-section {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 25px;
        margin-top: 25px;
      }

      .data-section-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--darker);
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
      }

      .cash-flow {
        display: flex;
        gap: 20px;
        margin-top: 25px;
      }

      .flow-card {
        flex: 1;
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 25px;
        text-align: center;
        border: 1px solid var(--border);
      }

      .flow-card.income {
        border-top: 4px solid var(--success);
      }

      .flow-card.spending {
        border-top: 4px solid var(--danger);
      }

      .flow-title {
        font-size: 17px;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--darker);
      }

      .flow-value {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .flow-info {
        font-size: 14px;
        color: var(--gray);
      }

      .status-badge {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-badge.positive {
        background-color: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }

      .status-badge.negative {
        background-color: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }

      /* 持仓管理页面特有样式 */
      .positions-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
      }

      .positions-table-container {
        grid-column: span 2;
      }

      .positions-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .positions-table th {
        background-color: var(--primary);
        color: white;
        text-align: left;
        padding: 15px;
        font-weight: 500;
      }

      .positions-table td {
        padding: 15px;
        border-bottom: 1px solid var(--border);
      }

      .positions-table tr:nth-child(even) {
        background-color: var(--light);
      }

      .positions-table tr:hover {
        background-color: rgba(59, 130, 246, 0.05);
      }

      .position-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        padding: 6px 12px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
      }

      .action-btn.edit {
        background-color: rgba(245, 158, 11, 0.1);
        color: var(--warning);
      }

      .action-btn.delete {
        background-color: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }

      .position-details {
        display: flex;
        align-items: center;
      }

      .position-icon {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        background-color: rgba(37, 99, 235, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        color: var(--primary);
      }

      .position-name {
        font-weight: 600;
      }

      .position-ticker {
        font-size: 14px;
        color: var(--gray);
      }

      .position-change {
        font-weight: 600;
      }

      .position-change.positive {
        color: var(--success);
      }

      .position-change.negative {
        color: var(--danger);
      }

      .position-percentage {
        font-weight: 600;
        color: var(--dark);
      }

      .gainers-losers {
        grid-column: span 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .gainers-container,
      .losers-container {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .section-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--darker);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .gainers-list,
      .losers-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .filter-bar {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        padding: 15px;
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .filter-group label {
        font-size: 14px;
        color: var(--gray);
      }

      .filter-group select,
      .filter-group input {
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background-color: white;
      }

      footer {
        margin-top: 40px;
        text-align: center;
        padding: 20px 0;
        color: var(--gray);
        font-size: 14px;
        border-top: 1px solid var(--border);
      }

      @media (max-width: 1200px) {
        .dashboard-layout {
          grid-template-columns: 1fr;
        }

        .positions-container {
          grid-template-columns: 1fr;
        }

        .positions-table-container {
          grid-column: span 1;
        }
      }

      @media (max-width: 768px) {
        header {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }

        .nav-tabs {
          flex-wrap: wrap;
          justify-content: center;
        }

        .summary-cards {
          grid-template-columns: 1fr;
        }

        .cash-flow {
          flex-direction: column;
        }

        .gainers-losers {
          grid-template-columns: 1fr;
        }

        .filter-bar {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- 顶部导航栏 -->
      <header>
        <div class="logo">
          <i class="fas fa-chart-line"></i>
          <h1>Financial Asset Management System</h1>
        </div>

        <ul class="nav-tabs">
          <li><a href="#" class="active">Asset Management</a></li>
          <li><a href="./trades.html">Trade Management</a></li>
          <li><a href="./stocks.html">Stock Trading</a></li>
        </ul>
      </header>

      <!-- 持仓管理内容 -->
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Assets Management</h2>
        </div>

        <!-- 持仓概览卡片 -->
        <!-- 资产概览卡片 -->
        <div class="summary-cards">
          <div class="summary-card">
            <div class="summary-card-title">
              <i class="fas fa-wallet"></i>
              Total Assets
            </div>
            <div class="summary-card-value" id="total-assets">
              $2,317,371.20
            </div>
          </div>

          <div class="summary-card">
            <div class="summary-card-title">
              <i class="fas fa-chart-line"></i>
              Total Profit/Loss
            </div>
            <div class="summary-card-value positive" id="total-profit-loss">
              $63,253.45
            </div>
          </div>

          <div class="summary-card">
            <div class="summary-card-title">
              <i class="fas fa-sync"></i>
              Daily Profit/Loss
            </div>
            <div class="summary-card-value negative" id="daily-profit-loss">
              -$3,210.15
            </div>
          </div>

          <div class="summary-card">
            <div class="summary-card-title">
              <i class="fas fa-coins"></i>
              Total Market Value
            </div>
            <div class="summary-card-value" id="total-market-value">
              $1,963,253.45
            </div>
          </div>
        </div>

        <!-- 现金流 -->
        <div class="data-section">
          <div class="cash-flow">
            <div class="flow-card income">
              <div class="flow-title">Income</div>
              <div class="flow-value positive" id="cash-flow-income">
                $18,665
              </div>
              <div class="flow-info">Last 30 Days</div>
            </div>

            <div class="flow-card spending">
              <div class="flow-title">Spending</div>
              <div class="flow-value negative" id="cash-flow-outcome">
                $42,500
              </div>
              <div class="flow-info">Last 30 Days</div>
            </div>
          </div>
        </div>

        <!-- 持仓内容区域 -->
        <div class="positions-container">
          <!-- 持仓分布图表 -->
          <div class="distribution-chart">
            <div class="data-section">
              <div class="data-section-title">Position Distribution</div>
              <div class="chart-container">
                <canvas id="positionDistributionChart"></canvas>
              </div>
            </div>
          </div>

          <!-- 涨跌股列表 -->
          <div class="gainers-losers">
            <div class="gainers-container">
              <div class="section-title">
                <i class="fas fa-arrow-up positive"></i>
                Top Gainers
              </div>
              <div class="gainers-list" id="gainers-list">
                <!-- Generated by JS -->
              </div>
            </div>

            <div class="losers-container">
              <div class="section-title">
                <i class="fas fa-arrow-down negative"></i>
                Top Losers
              </div>
              <div class="losers-list" id="losers-list">
                <!-- Generated by JS -->
              </div>
            </div>
          </div>

          <!-- 持仓表格 -->
          <div class="positions-table-container">
            <div class="data-section">
              <div class="data-section-title">Position Details</div>
              <table class="positions-table">
                <thead>
                  <tr>
                    <th>Stock</th>
                    <th>Cost Price</th>
                    <th>Current Price</th>
                    <th>Quantity</th>
                    <th>Daily Profit/Loss</th>
                    <th>Position Ratio</th>
                    <th>Position Value</th>
                  </tr>
                </thead>
                <tbody id="positions-table-body">
                  <!-- Generated by JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <p>© 2025 Financial Asset Management System | Last Data Update: 2025-07-28 15:30 EST</p>
      </footer>
    </div>

    <script>
      // 模拟持仓数据 - 对应Positions表
      const positionsData = [
        {
          id: 1,
          stock_id: 101,
          stock_name: 'Apple Inc.',
          stock_cost: 172.5,
          stock_current_price: 198.35,
          quantity: 500,
          daily_profit_loss: 2125.5,
          position_percentage: 18.5,
        },
        {
          id: 2,
          stock_id: 102,
          stock_name: 'Microsoft Corp.',
          stock_cost: 325.6,
          stock_current_price: 338.75,
          quantity: 300,
          daily_profit_loss: -645.0,
          position_percentage: 15.2,
        },
        {
          id: 3,
          stock_id: 103,
          stock_name: 'Alphabet Inc. Class A',
          stock_cost: 135.25,
          stock_current_price: 142.8,
          quantity: 400,
          daily_profit_loss: 1020.0,
          position_percentage: 12.3,
        },
        {
          id: 4,
          stock_id: 104,
          stock_name: 'Amazon.com Inc.',
          stock_cost: 178.9,
          stock_current_price: 182.45,
          quantity: 250,
          daily_profit_loss: 887.5,
          position_percentage: 9.8,
        },
        {
          id: 5,
          stock_id: 105,
          stock_name: 'Tesla Inc.',
          stock_cost: 210.3,
          stock_current_price: 225.75,
          quantity: 200,
          daily_profit_loss: 1090.0,
          position_percentage: 8.5,
        },
        {
          id: 6,
          stock_id: 106,
          stock_name: 'Berkshire Hathaway',
          stock_cost: 412.8,
          stock_current_price: 435.25,
          quantity: 150,
          daily_profit_loss: 367.5,
          position_percentage: 7.2,
        },
        {
          id: 7,
          stock_id: 107,
          stock_name: 'NVIDIA Corp.',
          stock_cost: 425.6,
          stock_current_price: 410.25,
          quantity: 100,
          daily_profit_loss: -1535.0,
          position_percentage: 5.8,
        },
        {
          id: 8,
          stock_id: 108,
          stock_name: 'TSMC',
          stock_cost: 95.4,
          stock_current_price: 102.75,
          quantity: 600,
          daily_profit_loss: 441.0,
          position_percentage: 4.9,
        },
        {
          id: 9,
          stock_id: 109,
          stock_name: 'JPMorgan Chase',
          stock_cost: 145.2,
          stock_current_price: 152.4,
          quantity: 350,
          daily_profit_loss: 252.0,
          position_percentage: 4.3,
        },
        {
          id: 10,
          stock_id: 110,
          stock_name: 'UnitedHealth Group',
          stock_cost: 480.3,
          stock_current_price: 495.25,
          quantity: 80,
          daily_profit_loss: 119.6,
          position_percentage: 3.9,
        },
      ]

      // 计算总持仓价值
      function calculateTotalPositionValue() {
        return positionsData.reduce((total, position) => {
          return total + position.stock_current_price * position.quantity
        }, 0)
      }

      // 计算总盈亏
      function calculateTotalProfitLoss() {
        return positionsData.reduce((total, position) => {
          const positionProfit =
            (position.stock_current_price - position.stock_cost) *
            position.quantity
          return total + positionProfit
        }, 0)
      }

      // 计算当日盈亏
      function calculateDailyProfitLoss() {
        return positionsData.reduce((total, position) => {
          return total + position.daily_profit_loss
        }, 0)
      }

      // 货币格式化函数
      function formatCurrency(value) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        }).format(value)
      }

      // 货币格式化函数
      function formatCurrency(value) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        }).format(value)
      }

      // 现金流计算（基于总现金流）
      function calculateCashFlow(totalCashFlow) {
        // 这里简化处理，实际项目中会有更复杂的逻辑
        const income = 18665 // 来自其他数据源
        const outcome = 42500 // 来自其他数据源
        return {
          income: income,
          outcome: outcome,
          netFlow: income - outcome,
        }
      }

      // 百分比格式化函数
      function formatPercentage(value) {
        return value.toFixed(2) + '%'
      }

      // 渲染持仓表格
      function renderPositionsTable() {
        const tableBody = document.getElementById('positions-table-body')
        tableBody.innerHTML = ''

        const totalValue = calculateTotalPositionValue()

        positionsData.forEach((position) => {
          const positionValue = position.stock_current_price * position.quantity
          const positionProfit =
            (position.stock_current_price - position.stock_cost) *
            position.quantity
          const positionProfitPercentage = (
            ((position.stock_current_price - position.stock_cost) /
              position.stock_cost) *
            100
          ).toFixed(2)

          const row = document.createElement('tr')

          row.innerHTML = `
                    <td>
                        <div class="position-details">
                            <div class="position-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>
                                <div class="position-name">${
                                  position.stock_name
                                }</div>
                                <div class="position-ticker"></div>
                            </div>
                        </div>
                    </td>
                    <td>${formatCurrency(position.stock_cost)}</td>
                    <td>${formatCurrency(position.stock_current_price)}</td>
                    <td>${position.quantity}</td>
                    <td class="position-change ${
                      position.daily_profit_loss >= 0 ? 'positive' : 'negative'
                    }">
                        ${formatCurrency(position.daily_profit_loss)}
                    </td>
                    <td class="position-percentage">${
                      position.position_percentage
                    }%</td>
                    <td>${formatCurrency(positionValue)}</td>
                `

          tableBody.appendChild(row)
        })
      }

      // 渲染涨跌股列表
      function renderGainersAndLosers() {
        const gainersList = document.getElementById('gainers-list')
        const losersList = document.getElementById('losers-list')

        gainersList.innerHTML = ''
        losersList.innerHTML = ''

        // 排序：按当日盈亏降序排列
        const sortedPositions = [...positionsData].sort(
          (a, b) => b.daily_profit_loss - a.daily_profit_loss
        )

        // 取前5名上涨股
        sortedPositions.slice(0, 5).forEach((position) => {
          if (position.daily_profit_loss <= 0) return

          const positionProfitPercentage = (
            ((position.stock_current_price - position.stock_cost) /
              position.stock_cost) *
            100
          ).toFixed(2)

          const item = document.createElement('div')
          item.className = 'position-item'
          item.innerHTML = `
                    <div class="position-info">
                        <div class="position-item-name">${position.stock_name}</div>
                        <div class="position-item-ticker">ID: ${position.stock_id}</div>
                    </div>
                    <div class="position-item-change positive">+${positionProfitPercentage}%</div>
                `

          gainersList.appendChild(item)
        })

        // 取后5名下跌股
        sortedPositions
          .slice(-5)
          .reverse()
          .forEach((position) => {
            if (position.daily_profit_loss >= 0) return

            const positionProfitPercentage = (
              ((position.stock_current_price - position.stock_cost) /
                position.stock_cost) *
              100
            ).toFixed(2)

            const item = document.createElement('div')
            item.className = 'position-item'
            item.innerHTML = `
                    <div class="position-info">
                        <div class="position-item-name">${position.stock_name}</div>
                        <div class="position-item-ticker">ID: ${position.stock_id}</div>
                    </div>
                    <div class="position-item-change negative">${positionProfitPercentage}%</div>
                `

            losersList.appendChild(item)
          })
      }

      // 渲染持仓分布图表
      function renderPositionDistributionChart() {
        const ctx = document
          .getElementById('positionDistributionChart')
          .getContext('2d')

        // 准备图表数据
        const labels = positionsData.map((p) => p.stock_name)
        const data = positionsData.map((p) => p.position_percentage)
        const backgroundColors = [
          '#3b82f6',
          '#10b981',
          '#f59e0b',
          '#ef4444',
          '#8b5cf6',
          '#06b6d4',
          '#f97316',
          '#ec4899',
          '#a855f7',
          '#64748b',
        ]

        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [
              {
                data: data,
                backgroundColor: backgroundColors,
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  boxWidth: 12,
                  padding: 15,
                  font: {
                    size: 12,
                  },
                },
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${context.parsed}%`
                  },
                },
              },
            },
            cutout: '60%',
          },
        })
      }

      // 初始化页面
      document.addEventListener('DOMContentLoaded', function () {
        // 只渲染表格、涨跌股、图表，不再操作已删除的卡片元素
        renderPositionsTable()
        renderGainersAndLosers()
        renderPositionDistributionChart()
        // 填充资产数据
        document.getElementById('total-assets').textContent = formatCurrency(
          assetsData.total_assets
        )
        document.getElementById('total-profit-loss').textContent =
          formatCurrency(assetsData.total_profit_loss)
        document.getElementById('daily-profit-loss').textContent =
          formatCurrency(assetsData.daily_profit_loss)
        document.getElementById('total-market-value').textContent =
          formatCurrency(assetsData.total_market_value)

        // 现金流分析（模拟收入与支出）
        const cashFlow = calculateCashFlow(assetsData.cash_flow)
        document.getElementById('cash-flow-income').textContent =
          formatCurrency(cashFlow.income)
        document.getElementById('cash-flow-outcome').textContent =
          formatCurrency(cashFlow.outcome)

        // 渲染净资产图表
        renderNetWorthChart()
      })
    </script>
  </body>
</html>
